<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VINIX7 Skill Match+ | Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #2196F3;
            --logo-blue: #003399;
            --logo-yellow: #FFC107;
            --text-dark: #333;
            --text-light: #666;
            --bg-color: #f5f5f5;
            --border-color: #e0e0e0;
            --success-color: #4CAF50;
            --danger-color: #f44336;
            --warning-color: #ff9800;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--bg-color); color: var(--text-dark); line-height: 1.6; }
        a { text-decoration: none; color: inherit; }
        ul, ol { list-style: none; }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* HEADER */
        header {
            background: #fff; padding: 15px 0; border-bottom: 1px solid #eee;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .nav-wrapper { display: flex; justify-content: space-between; align-items: center; }
        .logo-brand { text-decoration: none; display: flex; align-items: center; font-size: 1.6rem; }
        .logo-vinix { font-weight: 800; color: var(--logo-blue); letter-spacing: -1px; }
        .logo-seven { font-weight: 800; color: var(--logo-yellow); }
        .logo-tagline { font-weight: 700; color: #000; font-size: 1.1rem; margin-left: 5px; }
        .admin-badge { background: var(--danger-color); color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; margin-left: 10px; }

        .nav-right { display: flex; align-items: center; gap: 20px; }
        .profile-wrapper { position: relative; display: inline-block; }
        .user-icon { color: #000; font-size: 2rem; cursor: pointer; }
        .dropdown-box {
            display: none; position: absolute; top: 150%; right: 0;
            background: white; min-width: 200px; box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            padding: 15px; border-radius: 8px; z-index: 2000; border: 1px solid #eee;
        }
        .dropdown-name { font-weight: 700; display: block; margin-bottom: 5px; color: #333; }
        .dropdown-role { font-size: 0.85rem; color: #888; display: block; margin-bottom: 10px; }
        .btn-logout {
            display: block; width: 100%; padding: 8px 0; background: #f5f5f5; color: #333;
            text-align: center; border-radius: 5px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn-logout:hover { background: #e0e0e0; }
        .show { display: block; animation: slideDown 0.2s ease; }
        @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }

        /* MAIN CONTENT */
        .admin-container { padding: 40px 0; min-height: calc(100vh - 200px); }

        .admin-header {
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .admin-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--logo-blue);
        }

        .admin-header p {
            color: var(--text-light);
            font-size: 1rem;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary-color);
            transition: 0.3s;
        }

        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-card.users { border-left-color: #4CAF50; }
        .stat-card.mentors { border-left-color: #2196F3; }
        .stat-card.registrations { border-left-color: #FF9800; }
        .stat-card.certificates { border-left-color: #9C27B0; }

        .stat-label { color: var(--text-light); font-size: 0.95rem; margin-bottom: 10px; }
        .stat-number { font-size: 2.5rem; font-weight: 800; color: var(--text-dark); }
        .stat-icon { float: right; font-size: 2.5rem; opacity: 0.2; }

        /* TABS */
        .tabs-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .tabs-header {
            display: flex;
            border-bottom: 2px solid #eee;
            padding: 0 20px;
        }

        .tab-button {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            transition: 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-button:hover { color: var(--primary-color); }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active { display: block; }

        /* TABLE */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table thead {
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover { background: #fafafa; }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge.active { background: #C8E6C9; color: #2E7D32; }
        .badge.pending { background: #FFE0B2; color: #E65100; }
        .badge.completed { background: #BBDEFB; color: #1565C0; }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: 0.2s;
        }

        .btn-edit { background: #FFF3E0; color: #E65100; }
        .btn-edit:hover { background: #FFE0B2; }

        .btn-delete { background: #FFEBEE; color: #C62828; }
        .btn-delete:hover { background: #FFCDD2; }

        .btn-approve { background: #C8E6C9; color: #2E7D32; }
        .btn-approve:hover { background: #A5D6A7; }

        /* FORM */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
        }

        .form-group textarea { resize: vertical; min-height: 100px; }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
        }

        .btn-primary:hover { background: #1976D2; }

        /* MODAL STYLES */
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 30px;
            border-top: 1px solid #eee;
            color: #888;
            font-size: 0.9rem;
            margin-top: 60px;
        }

        @media (max-width: 768px) {
            .tabs-header { flex-wrap: wrap; }
            .tab-button { padding: 12px 15px; font-size: 0.9rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .admin-header h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container nav-wrapper">
            <a href="dashboardadmin.html" class="logo-brand">
                <span class="logo-vinix">VINIX</span><span class="logo-seven">7</span><span class="logo-tagline">Skill Match+</span>
                <span class="admin-badge">ADMIN</span>
            </a>
            <div class="nav-right">
                <div class="profile-wrapper">
                    <i class="fas fa-user-circle user-icon" onclick="toggleDropdown()"></i>
                    <div class="dropdown-box" id="userDropdown">
                        <span class="dropdown-name" id="profileName">Administrator</span>
                        <span class="dropdown-role">Admin Panel</span>
                        <a href="login.html" class="btn-logout" onclick="logoutUser(event)">Log Out</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container admin-container">

        <div class="admin-header">
            <h1><i class="fas fa-chart-line"></i> Dashboard Admin</h1>
            <p>Kelola platform VINIX7 Skill Match+ dari sini</p>
        </div>

        <!-- STATS -->
        <div class="stats-grid">
            <div class="stat-card users">
                <div class="stat-label">Total Pengguna</div>
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-icon"><i class="fas fa-users"></i></div>
            </div>
            <div class="stat-card mentors">
                <div class="stat-label">Total Mentors</div>
                <div class="stat-number" id="totalMentors">12</div>
                <div class="stat-icon"><i class="fas fa-chalkboard-user"></i></div>
            </div>
            <div class="stat-card registrations">
                <div class="stat-label">Pendaftaran Aktif</div>
                <div class="stat-number" id="totalRegistrations">0</div>
                <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
            </div>
            <div class="stat-card certificates">
                <div class="stat-label">Sertifikat Dikeluarkan</div>
                <div class="stat-number" id="totalCertificates">0</div>
                <div class="stat-icon"><i class="fas fa-certificate"></i></div>
            </div>
        </div>

        <!-- TABS -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-button active" onclick="switchTab('overview', this)">
                    <i class="fas fa-home"></i> Overview
                </button>
                <button class="tab-button" onclick="switchTab('users', this)">
                    <i class="fas fa-users"></i> Kelola Pengguna
                </button>
                <button class="tab-button" onclick="switchTab('registrations', this)">
                    <i class="fas fa-clipboard-list"></i> Pendaftaran
                </button>
                <button class="tab-button" onclick="switchTab('upgradeSchedule', this)">
                    <i class="fas fa-calendar-alt"></i> Upgrade Jadwal
                </button>
                <button class="tab-button" onclick="switchTab('certificates', this)">
                    <i class="fas fa-certificate"></i> Sertifikat
                </button>
                <button class="tab-button" onclick="switchTab('settings', this)">
                    <i class="fas fa-cog"></i> Pengaturan
                </button>
            </div>

            <!-- TAB: OVERVIEW -->
            <div id="overview" class="tab-content active">
                <h2>Selamat datang di Admin Dashboard</h2>
                <p style="margin-top: 15px; color: var(--text-light);">Gunakan menu di atas untuk mengelola platform VINIX7 Skill Match+. Anda dapat:</p>
                <ul style="margin-top: 20px; margin-left: 20px; color: var(--text-light);">
                    <li>üë• Melihat dan mengelola semua pengguna terdaftar</li>
                    <li>üìã Menyetujui atau menolak pendaftaran peserta</li>
                    <li>üìú Mengelola penerbitan sertifikat peserta</li>
                    <li>‚öôÔ∏è Mengatur konfigurasi platform</li>
                </ul>
            </div>

            <!-- TAB: USERS -->
            <div id="users" class="tab-content">
                <h2>Kelola Pengguna</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Bergabung</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--text-light);">
                                Tidak ada pengguna terdaftar
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- TAB: REGISTRATIONS -->
            <div id="registrations" class="tab-content">
                <h2>Pendaftaran Program</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Peserta</th>
                            <th>Email</th>
                            <th>No. Hp</th>
                            <th>Paket</th>
                            <th>Skill</th>
                            <th>Status</th>
                            <th>Tanggal</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="registrationTableBody">
                        <tr>
                            <td colspan="9" style="text-align: center; color: var(--text-light);">
                                Tidak ada pendaftaran
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- TAB: UPGRADE SCHEDULE -->
            <div id="upgradeSchedule" class="tab-content">
                <h2>Pengaturan Jadwal Upgrade Skill</h2>
                <p style="color: var(--text-light); margin-bottom: 15px;">Edit jadwal pertemuan (hari, waktu), materi, dan link untuk tiap pertemuan.</p>
                <div style="margin-bottom: 15px;">
                    <button class="btn-primary" onclick="initializeDefaultUpgradeSchedule()">Reset ke Default</button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Hari</th>
                            <th>Waktu</th>
                            <th>Materi</th>
                            <th>Link</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="upgradeScheduleTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: var(--text-light);">Belum ada data jadwal</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Modal edit schedule - per-day editor -->
                <div id="scheduleModal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:3000; align-items:center; justify-content:center; overflow:auto;">
                    <div style="background:white; padding:20px; border-radius:8px; width:85%; max-width:450px; margin:20px auto; box-shadow: 0 5px 20px rgba(0,0,0,0.2); max-height:85vh; overflow-y:auto;">
                        <h3 id="scheduleModalTitle" style="margin-bottom:15px; font-size:1.2rem;">Edit Jadwal Pertemuan</h3>
                        <form id="scheduleForm">
                            <input type="hidden" id="schedId">
                            <div class="form-group" style="margin-bottom:12px;"><label style="margin-bottom:5px;">Pertemuan No</label><input id="schedPertemuan" class="form-control" readonly style="padding:8px;"></div>
                            
                            <!-- Senin Section -->
                            <div style="border:1px solid #ddd; padding:12px; border-radius:5px; margin-bottom:10px; background:#f9f9f9;">
                                <h4 style="margin-bottom:8px; font-size:0.95rem;">SENIN</h4>
                                <div class="form-group" style="margin-bottom:8px;"><label style="margin-bottom:4px; font-size:0.9rem;">Jam</label><input id="schedSeniMjam" class="form-control" placeholder="09.00 - 11.30" style="padding:8px; font-size:0.9rem;"></div>
                                <div class="form-group" style="margin-bottom:8px;"><label style="margin-bottom:4px; font-size:0.9rem;">Materi</label><input id="schedSeniMateri" class="form-control" placeholder="Materi" style="padding:8px; font-size:0.9rem;"></div>
                                <div class="form-group" style="margin-bottom:0;"><label style="margin-bottom:4px; font-size:0.9rem;">Link</label><input id="schedSeniLink" class="form-control" placeholder="https://..." style="padding:8px; font-size:0.9rem;"></div>
                            </div>
                            
                            <!-- Selasa Section -->
                            <div style="border:1px solid #ddd; padding:12px; border-radius:5px; margin-bottom:10px; background:#f9f9f9;">
                                <h4 style="margin-bottom:8px; font-size:0.95rem;">SELASA</h4>
                                <div class="form-group" style="margin-bottom:8px;"><label style="margin-bottom:4px; font-size:0.9rem;">Jam</label><input id="schedSelasaJam" class="form-control" placeholder="09.00 - 11.30" style="padding:8px; font-size:0.9rem;"></div>
                                <div class="form-group" style="margin-bottom:8px;"><label style="margin-bottom:4px; font-size:0.9rem;">Materi</label><input id="schedSelasaMateri" class="form-control" placeholder="Materi" style="padding:8px; font-size:0.9rem;"></div>
                                <div class="form-group" style="margin-bottom:0;"><label style="margin-bottom:4px; font-size:0.9rem;">Link</label><input id="schedSelasaLink" class="form-control" placeholder="https://..." style="padding:8px; font-size:0.9rem;"></div>
                            </div>
                            
                            <!-- Rabu Section -->
                            <div style="border:1px solid #ddd; padding:12px; border-radius:5px; margin-bottom:15px; background:#f9f9f9;">
                                <h4 style="margin-bottom:8px; font-size:0.95rem;">RABU</h4>
                                <div class="form-group" style="margin-bottom:8px;"><label style="margin-bottom:4px; font-size:0.9rem;">Jam</label><input id="schedRabuJam" class="form-control" placeholder="09.00 - 11.30" style="padding:8px; font-size:0.9rem;"></div>
                                <div class="form-group" style="margin-bottom:8px;"><label style="margin-bottom:4px; font-size:0.9rem;">Materi</label><input id="schedRabuMateri" class="form-control" placeholder="Materi" style="padding:8px; font-size:0.9rem;"></div>
                                <div class="form-group" style="margin-bottom:0;"><label style="margin-bottom:4px; font-size:0.9rem;">Link</label><input id="schedRabuLink" class="form-control" placeholder="https://..." style="padding:8px; font-size:0.9rem;"></div>
                            </div>
                            
                            <div style="display:flex; gap:10px; margin-top:10px;"><button class="btn-primary" type="submit" style="flex:1; padding:10px;">Simpan</button><button type="button" class="btn-primary" style="flex:1; background:#757575; padding:10px;" onclick="closeScheduleModal()">Batal</button></div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- TAB: CERTIFICATES -->
            <div id="certificates" class="tab-content">
                <h2>Kelola Sertifikat</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="showCertificateModal('add')">
                        <i class="fas fa-plus"></i> Terbitkan Sertifikat Baru
                    </button>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Peserta</th>
                            <th>Email</th>
                            <th>Skill</th>
                            <th>No. Sertifikat</th>
                            <th>Tanggal</th>
                            <th>File</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="certificateTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center; color: var(--text-light);">
                                Tidak ada sertifikat
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- MODAL: TAMBAH/EDIT SERTIFIKAT -->
            <div id="certificateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; align-items: center; justify-content: center;">
                <div style="background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);">
                    <h3 id="modalTitle">Terbitkan Sertifikat Baru</h3>
                    <form id="certificateForm" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>Nama Peserta</label>
                            <input type="text" id="certNama" class="form-control" placeholder="Nama lengkap peserta" required>
                        </div>
                        <div class="form-group">
                            <label>Email Peserta</label>
                            <input type="email" id="certEmail" class="form-control" placeholder="Email peserta" required>
                        </div>
                        <div class="form-group">
                            <label>Skill</label>
                            <select id="certSkill" class="form-control" required>
                                <option value="">Pilih Skill</option>
                                <option value="UI/UX Design">UI/UX Design</option>
                                <option value="Web Development">Web Development</option>
                                <option value="Graphic Design">Graphic Design</option>
                                <option value="Aplikasi Perkantoran">Aplikasi Perkantoran</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Upload File Sertifikat (PNG/JPG)</label>
                            <input type="file" id="certFile" class="form-control" accept="image/*">
                            <small id="certFileNote" style="color: var(--text-light);">File akan ditampilkan di e-certificate user</small>
                        </div>
                        <div class="form-group">
                            <label>Catatan (Opsional)</label>
                            <textarea id="certCatatan" class="form-control" placeholder="Catatan atau keterangan sertifikat" style="height: 80px;"></textarea>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn-primary" style="flex: 1;">Simpan Sertifikat</button>
                            <button type="button" class="btn-primary" style="flex: 1; background: #757575;" onclick="closeCertificateModal()">Batal</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- TAB: SETTINGS -->
            <div id="settings" class="tab-content">
                <h2>Pengaturan Platform</h2>
                <form style="max-width: 600px;">
                    <div class="form-group">
                        <label>Nama Platform</label>
                        <input type="text" value="VINIX7 Skill Match+" readonly>
                    </div>
                    <div class="form-group">
                        <label>Email Support</label>
                        <input type="email" placeholder="support@vinix7.com" value="support@vinix7.com">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp Support</label>
                        <input type="text" placeholder="+62 812 3456 7890" value="+62 812 3456 7890">
                    </div>
                    <div class="form-group">
                        <label>Deskripsi Platform</label>
                        <textarea placeholder="Deskripsi singkat platform...">Platform pengembangan skill dan career matching untuk mahasiswa dan lulusan baru.</textarea>
                    </div>
                    <button type="button" class="btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Simpan Pengaturan
                    </button>
                </form>
            </div>

        </div>

    </div>

    <footer>
        <p>¬© 2025 VINIX7 Skill Match+ Admin Panel. All rights reserved.</p>
    </footer>

    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAdminRole();
            loadDashboardStats();
            loadUsers();
            loadRegistrations();
            loadUpgradeSchedule();
            loadCertificates();
        });

        // Check if user is admin
        function checkAdminRole() {
            const role = localStorage.getItem('role');
            const username = localStorage.getItem('username');
            
            if (role !== 'admin') {
                alert('Akses ditolak! Anda bukan admin.');
                window.location.href = 'dashboard.html';
                return;
            }
            
            document.getElementById('profileName').innerText = username || 'Administrator';
        }

        // Load Dashboard Stats
        function loadDashboardStats() {
            // Count registered users
            const users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            document.getElementById('totalUsers').innerText = users.length;

            // Count registrations
            const registrations = JSON.parse(localStorage.getItem('vinix_registrations')) || [];
            document.getElementById('totalRegistrations').innerText = registrations.length;

            // Count certificates
            const certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
            document.getElementById('totalCertificates').innerText = certificates.length;
        }

        // Load Users Table
        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            const tbody = document.getElementById('userTableBody');
            
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-light);">Tidak ada pengguna terdaftar</td></tr>';
                return;
            }

            tbody.innerHTML = users.map((user, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong>${user.name || 'N/A'}</strong></td>
                    <td>${user.email || 'N/A'}</td>
                    <td><span class="badge active">Aktif</span></td>
                    <td>${user.joinDate || 'N/A'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-delete" onclick="deleteUser(${user.id})">Hapus</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Load Registrations Table
        function loadRegistrations() {
            const registrations = JSON.parse(localStorage.getItem('vinix_registrations')) || [];
            const tbody = document.getElementById('registrationTableBody');
            
            if (registrations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-light);">Tidak ada pendaftaran</td></tr>';
                return;
            }

            tbody.innerHTML = registrations.map((reg, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong>${reg.nama || 'N/A'}</strong></td>
                    <td>${reg.email || 'N/A'}</td>
                    <td>${reg.noHp || 'N/A'}</td>
                    <td><span class="badge pending">${reg.paket || 'N/A'}</span></td>
                    <td>${reg.skill || 'N/A'}</td>
                    <td><span class="badge ${reg.status === 'pending' ? 'pending' : 'completed'}">${reg.status === 'pending' ? 'Menunggu' : 'Selesai'}</span></td>
                    <td>${reg.tanggalDaftar || 'N/A'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="editRegistration(${reg.id})">Edit</button>
                            <button class="btn-small btn-delete" onclick="deleteRegistration(${reg.id})">Hapus</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Load Upgrade Schedule Table - per-day model
        function loadUpgradeSchedule() {
            const schedule = JSON.parse(localStorage.getItem('vinix_upgrade_schedule')) || [];
            const tbody = document.getElementById('upgradeScheduleTableBody');

            if (!schedule || schedule.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-light);">Belum ada data jadwal</td></tr>';
                return;
            }

            tbody.innerHTML = schedule.map((s, i) => {
                const senin = (s.entries || []).find(e => e.day === 'Senin');
                const selasa = (s.entries || []).find(e => e.day === 'Selasa');
                const rabu = (s.entries || []).find(e => e.day === 'Rabu');
                return `
                <tr>
                    <td>${s.pertemuan || i+1}</td>
                    <td>Senin, Selasa, Rabu</td>
                    <td>${senin?.time || '-'} / ${selasa?.time || '-'} / ${rabu?.time || '-'}</td>
                    <td>${senin?.materi || '-'}</td>
                    <td>${senin?.link ? '<a href="'+senin.link+'" target="_blank">Link</a>' : '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-edit" onclick="showScheduleModal('edit', ${i})">Edit</button>
                            <button class="btn-small btn-delete" onclick="deleteSchedule(${i})">Hapus</button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        function initializeDefaultUpgradeSchedule() {
            // Build default schedule (16 pertemuan) with per-day entries
            const defaultTime = localStorage.getItem('vinix_jadwal') || '09:00 - 11.30';
            const schedule = [];
            for (let i = 1; i <= 16; i++) {
                schedule.push({
                    id: Date.now() + i,
                    pertemuan: i,
                    entries: [
                        { day: 'Senin', time: defaultTime, materi: '-', link: '' },
                        { day: 'Selasa', time: defaultTime, materi: '-', link: '' },
                        { day: 'Rabu', time: defaultTime, materi: '-', link: '' }
                    ]
                });
            }
            localStorage.setItem('vinix_upgrade_schedule', JSON.stringify(schedule));
            loadUpgradeSchedule();
            alert('Jadwal default berhasil diinisialisasi.');
        }

        function showScheduleModal(mode, index) {
            const modal = document.getElementById('scheduleModal');
            const form = document.getElementById('scheduleForm');
            document.getElementById('schedId').value = index;

            if (mode === 'edit') {
                const schedule = JSON.parse(localStorage.getItem('vinix_upgrade_schedule')) || [];
                const s = schedule[index];
                if (!s) return alert('Data pertemuan tidak ditemukan.');
                
                document.getElementById('scheduleModalTitle').innerText = 'Edit Jadwal Pertemuan ' + (s.pertemuan || (index+1));
                document.getElementById('schedPertemuan').value = s.pertemuan || (index+1);
                
                // Load per-day data
                const senin = (s.entries || []).find(e => e.day === 'Senin') || { day:'Senin', time:'', materi:'', link:'' };
                const selasa = (s.entries || []).find(e => e.day === 'Selasa') || { day:'Selasa', time:'', materi:'', link:'' };
                const rabu = (s.entries || []).find(e => e.day === 'Rabu') || { day:'Rabu', time:'', materi:'', link:'' };
                
                document.getElementById('schedSeniMjam').value = senin.time || '';
                document.getElementById('schedSeniMateri').value = senin.materi || '';
                document.getElementById('schedSeniLink').value = senin.link || '';
                
                document.getElementById('schedSelasaJam').value = selasa.time || '';
                document.getElementById('schedSelasaMateri').value = selasa.materi || '';
                document.getElementById('schedSelasaLink').value = selasa.link || '';
                
                document.getElementById('schedRabuJam').value = rabu.time || '';
                document.getElementById('schedRabuMateri').value = rabu.materi || '';
                document.getElementById('schedRabuLink').value = rabu.link || '';
            }

            form.onsubmit = saveSchedule;
            modal.style.display = 'flex';
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').style.display = 'none';
        }

        function saveSchedule(e) {
            e.preventDefault();
            const idx = parseInt(document.getElementById('schedId').value);
            let schedule = JSON.parse(localStorage.getItem('vinix_upgrade_schedule')) || [];

            if (!schedule || schedule.length === 0) {
                initializeDefaultUpgradeSchedule();
                schedule = JSON.parse(localStorage.getItem('vinix_upgrade_schedule')) || [];
            }

            // Collect per-day data
            const entries = [
                {
                    day: 'Senin',
                    time: document.getElementById('schedSeniMjam').value || '',
                    materi: document.getElementById('schedSeniMateri').value || '',
                    link: document.getElementById('schedSeniLink').value || ''
                },
                {
                    day: 'Selasa',
                    time: document.getElementById('schedSelasaJam').value || '',
                    materi: document.getElementById('schedSelasaMateri').value || '',
                    link: document.getElementById('schedSelasaLink').value || ''
                },
                {
                    day: 'Rabu',
                    time: document.getElementById('schedRabuJam').value || '',
                    materi: document.getElementById('schedRabuMateri').value || '',
                    link: document.getElementById('schedRabuLink').value || ''
                }
            ];

            const entry = schedule[idx] || { pertemuan: idx+1 };
            entry.pertemuan = entry.pertemuan || idx+1;
            entry.entries = entries;

            schedule[idx] = entry;
            localStorage.setItem('vinix_upgrade_schedule', JSON.stringify(schedule));
            closeScheduleModal();
            loadUpgradeSchedule();
            alert('Jadwal pertemuan berhasil diperbarui.');
        }

        function deleteSchedule(index) {
            if (confirm('Apakah Anda yakin ingin menghapus jadwal pertemuan ini?')) {
                let schedule = JSON.parse(localStorage.getItem('vinix_upgrade_schedule')) || [];
                schedule.splice(index, 1);
                localStorage.setItem('vinix_upgrade_schedule', JSON.stringify(schedule));
                alert('Jadwal pertemuan berhasil dihapus.');
                loadUpgradeSchedule();
            }
        }

        // Load Certificates Table
        function loadCertificates() {
            const certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
            const tbody = document.getElementById('certificateTableBody');
            
            if (certificates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-light);">Tidak ada sertifikat</td></tr>';
                return;
            }

            tbody.innerHTML = certificates.map((cert, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong>${cert.nama || 'N/A'}</strong></td>
                    <td>${cert.email || 'N/A'}</td>
                    <td>${cert.skill || 'N/A'}</td>
                    <td>${cert.noCertifikat || 'CERT-' + cert.id}</td>
                    <td>${cert.tanggalTerbit || 'N/A'}</td>
                    <td>
                        ${cert.fileData ? '<i class="fas fa-file-image" style="color: var(--primary-color);"></i> Ada' : '<span style="color: var(--text-light);">-</span>'}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-approve" onclick="showCertificatePreview(${cert.id})" title="Lihat">Lihat</button>
                            <button class="btn-small btn-delete" onclick="deleteCertificate(${cert.id})" title="Hapus">Hapus</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Show Certificate Modal
        function showCertificateModal(mode, certId = null) {
            const modal = document.getElementById('certificateModal');
            const form = document.getElementById('certificateForm');
            const title = document.getElementById('modalTitle');
            
            // Reset form
            form.reset();
            document.getElementById('certNama').value = '';
            document.getElementById('certEmail').value = '';
            document.getElementById('certSkill').value = '';
            document.getElementById('certFile').value = '';
            document.getElementById('certCatatan').value = '';
            
            if (mode === 'add') {
                title.innerText = 'Terbitkan Sertifikat Baru';
                form.onsubmit = saveCertificate;
                // require file for new certificates
                document.getElementById('certFile').required = true;
                document.getElementById('certFileNote').innerText = 'File akan ditampilkan di e-certificate user';
            } else if (mode === 'edit' && certId) {
                title.innerText = 'Edit Sertifikat';
                const certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
                const cert = certificates.find(c => c.id === certId);
                
                if (cert) {
                    document.getElementById('certNama').value = cert.nama || '';
                    document.getElementById('certEmail').value = cert.email || '';
                    document.getElementById('certSkill').value = cert.skill || '';
                    document.getElementById('certCatatan').value = cert.catatan || '';
                    // file is optional when editing; show existing file name
                    const fileInput = document.getElementById('certFile');
                    fileInput.required = false;
                    const note = document.getElementById('certFileNote');
                    if (cert.fileName) note.innerText = 'File saat ini: ' + cert.fileName + ' (unggah file baru untuk mengganti)';
                    else note.innerText = 'Belum ada file. Unggah file jika ingin menambahkan.';

                    form.onsubmit = (e) => updateCertificate(e, certId);
                }
            }
            
            modal.style.display = 'flex';
        }

        function closeCertificateModal() {
            document.getElementById('certificateModal').style.display = 'none';
        }

        function saveCertificate(e) {
            e.preventDefault();
            
            const nama = document.getElementById('certNama').value;
            const email = document.getElementById('certEmail').value;
            const skill = document.getElementById('certSkill').value;
            const catatan = document.getElementById('certCatatan').value;
            const fileInput = document.getElementById('certFile');
            
            if (!nama || !email || !skill) {
                alert('Mohon isi semua field yang diperlukan!');
                return;
            }
            
            // Handle file upload
            if (fileInput.files.length === 0) {
                alert('Mohon pilih file sertifikat!');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const fileData = e.target.result;
                
                let certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
                const newCert = {
                    id: Date.now(),
                    nama: nama,
                    email: email,
                    skill: skill,
                    catatan: catatan,
                    noCertifikat: 'CERT-' + Date.now(),
                    tanggalTerbit: new Date().toLocaleDateString('id-ID'),
                    published: true,
                    fileName: file.name,
                    fileData: fileData // Base64 encoded file
                };
                
                certificates.push(newCert);
                localStorage.setItem('vinix_certificates', JSON.stringify(certificates));
                
                alert('Sertifikat berhasil diterbitkan untuk ' + nama);
                closeCertificateModal();
                loadCertificates();
                loadDashboardStats();
            };
            
            reader.readAsDataURL(file);
        }

        function editCertificate(certId) {
            showCertificateModal('edit', certId);
        }

                // Preview certificate in a new window/tab
                function showCertificatePreview(certId) {
                        const certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
                        const cert = certificates.find(c => c.id === certId);
                        if (!cert) return alert('Sertifikat tidak ditemukan.');
                        if (!cert.fileData) return alert('Tidak ada file sertifikat untuk peserta ini.');

                        const win = window.open('', '_blank');
                        const title = (cert.nama ? cert.nama + ' - ' : '') + (cert.skill || 'Sertifikat');
                        const html = `
                                <!doctype html>
                                <html>
                                <head>
                                    <meta charset="utf-8">
                                    <title>${title}</title>
                                    <style>body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;}
                                    img{max-width:95vw;max-height:80vh;border:1px solid #ddd;border-radius:4px}
                                    .meta{margin-top:12px;color:#444}</style>
                                </head>
                                <body>
                                    <h2 style="margin:8px 0">${cert.nama || ''}</h2>
                                    <div style="color:#666;margin-bottom:8px">${cert.skill || ''}</div>
                                    <img src="${cert.fileData}" alt="Sertifikat - ${cert.nama || ''}" />
                                    <div class="meta">${cert.noCertifikat || ''} ${cert.tanggalTerbit ? ' - ' + cert.tanggalTerbit : ''}</div>
                                </body>
                                </html>
                        `;
                        win.document.write(html);
                        win.document.close();
                }

        

        function updateCertificate(e, certId) {
            e.preventDefault();
            
            const nama = document.getElementById('certNama').value;
            const email = document.getElementById('certEmail').value;
            const skill = document.getElementById('certSkill').value;
            const catatan = document.getElementById('certCatatan').value;
            const fileInput = document.getElementById('certFile');
            
            if (!nama || !email || !skill) {
                alert('Mohon isi semua field yang diperlukan!');
                return;
            }
            
            let certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
            let cert = certificates.find(c => c.id === certId);
            
            if (cert) {
                cert.nama = nama;
                cert.email = email;
                cert.skill = skill;
                cert.catatan = catatan;
                
                // Jika ada file baru, update filenya
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                            cert.fileData = e.target.result;
                            cert.fileName = file.name;
                            cert.published = true;

                            localStorage.setItem('vinix_certificates', JSON.stringify(certificates));
                            alert('Sertifikat berhasil diperbarui!');
                            closeCertificateModal();
                            loadCertificates();
                    };
                    
                    reader.readAsDataURL(file);
                } else {
                        // Keep existing file; still mark as published
                        cert.published = cert.published || true;
                        localStorage.setItem('vinix_certificates', JSON.stringify(certificates));
                        alert('Sertifikat berhasil diperbarui!');
                        closeCertificateModal();
                        loadCertificates();
                }
            }
        }

        function deleteCertificate(certId) {
            if (confirm('Apakah Anda yakin ingin menghapus sertifikat ini?')) {
                let certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
                certificates = certificates.filter(c => c.id !== certId);
                localStorage.setItem('vinix_certificates', JSON.stringify(certificates));
                
                alert('Sertifikat berhasil dihapus!');
                loadCertificates();
                loadDashboardStats();
            }
        }

        // Tab Switcher
        function switchTab(tabName, button) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            button.classList.add('active');

            // Reload data when switching to tables
            if (tabName === 'users') loadUsers();
            if (tabName === 'registrations') loadRegistrations();
            if (tabName === 'upgradeSchedule') loadUpgradeSchedule();
            if (tabName === 'certificates') loadCertificates();
        }

        // Logout
        function toggleDropdown() {
            document.getElementById("userDropdown").classList.toggle("show");
        }

        function logoutUser(event) {
            event.preventDefault();
            localStorage.removeItem('username');
            localStorage.removeItem('email');
            localStorage.removeItem('role');
            window.location.href = 'login.html';
        }

        // Utility functions

        function deleteUser(id) {
            if (confirm('Apakah Anda yakin ingin menghapus pengguna ini?')) {
                let users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
                users = users.filter(u => u.id !== id);
                localStorage.setItem('registeredUsers', JSON.stringify(users));
                loadUsers();
                loadDashboardStats();
            }
        }

        // Edit a registration via prompts (simple editor)
        function editRegistration(id) {
            let registrations = JSON.parse(localStorage.getItem('vinix_registrations')) || [];
            const reg = registrations.find(r => r.id === id);
            if (!reg) {
                alert('Pendaftaran tidak ditemukan.');
                return;
            }

            const nama = prompt('Nama Peserta:', reg.nama) ?? reg.nama;
            const email = prompt('Email Peserta:', reg.email) ?? reg.email;
            const noHp = prompt('No. Hp:', reg.noHp) ?? reg.noHp;
            const paket = prompt('Paket:', reg.paket) ?? reg.paket;
            const skill = prompt('Skill:', reg.skill) ?? reg.skill;
            const status = prompt('Status (pending/completed):', reg.status) ?? reg.status;

            reg.nama = nama;
            reg.email = email;
            reg.noHp = noHp;
            reg.paket = paket;
            reg.skill = skill;
            reg.status = status;

            localStorage.setItem('vinix_registrations', JSON.stringify(registrations));
            alert('Data pendaftaran berhasil diperbarui.');
            loadRegistrations();
            loadDashboardStats();
        }

        function deleteRegistration(id) {
            if (confirm('Apakah Anda yakin ingin menghapus pendaftaran ini?')) {
                let registrations = JSON.parse(localStorage.getItem('vinix_registrations')) || [];
                registrations = registrations.filter(r => r.id !== id);
                localStorage.setItem('vinix_registrations', JSON.stringify(registrations));
                alert('Pendaftaran berhasil dihapus.');
                loadRegistrations();
                loadDashboardStats();
            }
        }

        function openCertificateForm() {
            const nama = prompt('Masukkan nama peserta:');
            if (!nama) return;
            
            const email = prompt('Masukkan email peserta:');
            if (!email) return;
            
            const skill = prompt('Masukkan skill yang dikuasai:');
            if (!skill) return;
            
            // Simpan sertifikat
            let certificates = JSON.parse(localStorage.getItem('vinix_certificates')) || [];
            const newCert = {
                id: Date.now(),
                nama: nama,
                email: email,
                skill: skill,
                noCertifikat: 'CERT-' + Date.now(),
                tanggalTerbit: new Date().toLocaleDateString('id-ID')
            };
            
            certificates.push(newCert);
            localStorage.setItem('vinix_certificates', JSON.stringify(certificates));
            
            alert('Sertifikat berhasil diterbitkan untuk ' + nama);
            loadCertificates();
            loadDashboardStats();
        }

        function saveSettings() {
            alert('Pengaturan berhasil disimpan!');
        }

        // Close modal when clicking outside
        window.onclick = function(e) {
            if (!e.target.matches('.user-icon')) {
                const dd = document.getElementById("userDropdown");
                if (dd.classList.contains('show')) dd.classList.remove('show');
            }
            
            const modal = document.getElementById('certificateModal');
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>

</body>
</html>
